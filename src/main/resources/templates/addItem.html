<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="index :: head"></head>
<body>
<nav th:replace="index :: navbar"></nav>
<div class="container">
    <select class="form-control" id="search-select-item">
        <option value="" selected="selected" th:text="#{addItem.info}">select2/select2</option>
    </select>

    <form th:object="${newTradeItemForm}" method="post" th:action="@{/addItem}">
        <input id="game-form-bggId" type="hidden" th:field="*{bggId}"/>
        <div class="form-group">
            <label class="control-label col-sm-2">Title: </label>

            <div class="col-sm-10">
                <p id="game-form-title" class="form-control-static">Please choose a game in searchbox.</p>
            </div>
        </div>
        <div class="form-group">
            <label class="control-label col-sm-2">Description: </label>
            <div class="col-sm-10">
                <textarea class="form-control col-sm-10" cols="10" th:field="*{description}" title="Description"></textarea>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-2"></div>
            <div class="col-sm-10">
                <input type="submit" class="btn btn-default" value="Confirm"/>
            </div>
        </div>
    </form>
</div>
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="../static/js/bootstrap.min.js" th:src="@{/js/bootstrap.min.js}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.2-rc.1/js/select2.min.js"></script>
<script type="text/javascript">
    $("#search-select-item").select2({
        ajax: {
            url: "/search",
            dataType: 'json',
            delay: 250,
            data: function (params) {
                return {
                    page: params.page,
                    title: params.term
                };
            },
            processResults: function (data, params) {
                params.page = params.page || 1;

                return {
                    results: data,
                    pagination: {
                        more: false
                    }
                };
            },
            cache: true
        },
        escapeMarkup: function (markup) {
            return markup;
        }, // let our custom formatter work
        minimumInputLength: 3,
        templateResult: formatRepo // omitted for brevity, see the source of this page
    });

    function formatRepo(item) {
        if (item.loading) return item.text;

        return $('<div/>').attr({class: 'media'})
                .append($('<div/>').attr({class: 'media-left'})
                        .append($('<a/>').attr({href: '#'})
                                .append($('<img/>').attr({src: item.thumbnailUrl}).click(onThumbnailClick(item)))))
                .append($('<div/>').attr({class: 'media-body'})
                        .append($('<h3/>').attr({class: 'media-heading'}).text(item.names[0])))
    }

    var onThumbnailClick = function (item) {
        $('#game-form-title').text(item.names[0]);
        $('#game-form-bggId').attr({value: item.bggId});
    }
</script>
</body>
</html>